import{f as k,t as A,l as I,v as w,w as T,u as K}from"./entry.e76eb76a.js";import{g as U,P as C,i as M}from"./index.52dd45d9.js";import{a as R,u as q,g as f}from"./usePayments.9012fabc.js";import"./api-product.df515047.js";import{r as P,c as x,o as E}from"./vue.178cf25e.js";import{b as D}from"./libs.b22191e3.js";const F=k("invoices",()=>{const a=P([]);async function d(){try{const e=await A();return e.docs&&(a.value=e.docs),e}catch(e){return console.error("Failed to fetch invoices.",e),{success:!1}}}return{fetchInvoices:d,invoices:a}});function H(){const a=P(),d=I(),e=R(),v=q(),y=F(),m=x(()=>v.licenses),{$region:l}=K(),S=async()=>{await v.updateLicenses({beforeUpdate:()=>Promise.all([d.fillUserInfo(),y.fetchInvoices()])})},b=t=>{const{validProducts:s,isSuccess:i,isUpgrade:c,provider:n="stripe"}=t;s.forEach(r=>{const u=r.productKey,o={product:r,provider:n,productKey:u,isUpgrade:c};M.track(i?"paymentSuccess":"paymentError",o)})},h=async t=>{const{validProducts:s,provider:i="stripe"}=t,c=f(s,m.value),n=s.map(p=>p.alias),r=c.map(p=>p.alias),u={source:U(),addProducts:n,removeProducts:r,quantity:1,recaptchaToken:l!=null&&l.isChinaRegion.value?"fake-china-recaptcha-token":void 0};e.addProductsInProcess(s),e.clearProductsToSubscribe();const o=await C.processPayment(i,u);return b({...t,isSuccess:o.success,isUpgrade:!!c.length}),o.success&&await S(),e.removeProductsInProcess(s),o},g=t=>{const{validProducts:s,provider:i="stripe"}=t,c=f(s,m.value),n=s.map(o=>o.alias),r=c.map(o=>o.alias),u=D("i8-referral-code")||void 0;T({provider:i,referralCode:u,recaptchaToken:a.value,source:"profile",addProducts:n,removeProducts:r,quantity:1})};return E(async()=>{a.value=await w()}),{subscribeMultipleProducts:h,subscribeMultipleProductsKeepAlive:g}}export{F as a,H as u};
