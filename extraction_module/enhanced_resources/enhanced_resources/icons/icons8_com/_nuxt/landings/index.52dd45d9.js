import{a6 as f,F as y,k as p,a7 as E,a8 as g,a9 as P,aa as S,f as R,u as _}from"./entry.e76eb76a.js";import{m,j as C}from"./libs.b22191e3.js";import"./index.4b7d8a63.js";import"./dayjs.min.3b0842e9.js";import{a as T}from"./api-product.df515047.js";import{g as v}from"./helper.016738b8.js";import{r as I}from"./vue.178cf25e.js";async function O(e){var r,s,t;try{const o={...e},n=f();n&&(o.referralCode=n);const a=await y(o);if(!a.success)throw new Error(a);if(a.actions&&a.actions.length){const{publishableKey:i,checkoutSessionId:c}=((r=a.actions)==null?void 0:r[0])??{},d=await(await p(()=>import("./stripe.esm.dc2fab41.js"),[],import.meta.url)).loadStripe(i);if(d)d.redirectToCheckout({sessionId:c});else throw new Error("Stripe is not loaded")}return{success:!0,actions:a.actions,url:(t=(s=a.actions)==null?void 0:s[0])==null?void 0:t.url}}catch(o){return{success:!1,message:o.response||o}}}async function A(e){var r,s;try{const t={...e},o=f();o&&(t.referralCode=o);const n=await y(t);if(!n.success)throw new Error(n);const a=((s=(r=n.actions)==null?void 0:r[0])==null?void 0:s.url)||null;if(a)window.location.href=a;else throw new Error("PayPal url is not defined");return{success:!0,url:a,actions:n.actions}}catch(t){return{success:!1,message:t.response||t}}}async function k(e){var r,s;try{const t={...e},o=f();o&&(t.referralCode=o);const n=await y(t);if(!n.success)throw new Error(n);const a=((s=(r=n.actions)==null?void 0:r[0])==null?void 0:s.url)||null;if(a)window.location.href=a;else throw new Error("AliPay url is not defined");return{success:!0,url:a,actions:n.actions}}catch(t){return{success:!1,message:t.response||t}}}async function L(e,r){const t=await(await p(()=>import("./stripe.esm.dc2fab41.js"),[],import.meta.url)).loadStripe(e);if(!t)throw new Error("Stripe instance not found");return t.confirmWechatPayPayment(r,{payment_method_options:{wechat_pay:{client:"web"}}})}async function U(e){var r,s;try{const t={...e},o=f();o&&(t.referralCode=o);const n=await E(t);if(!n.success)throw new Error(n);const{clientSecret:a,publishableKey:i}=((r=n.actions)==null?void 0:r[0])??{};let c=(s=n.actions)==null?void 0:s[0].orderId;if(!a||!i||!c)return{success:!1,message:"WeChat client secret or publishable key is not defined"};const{paymentIntent:l}=await L(i,a);return l?(l.status!=="succeeded"&&!l.last_payment_error&&(c=void 0),{success:!0,id:c,actions:n.actions}):{success:!1,message:"Error showing QR code: paymentIntent not found"}}catch(t){return{success:!1,message:t.response||t}}}async function M(e){return{success:!1,message:"Will be implemented later"}}async function N(e){try{const r=e?await g(e):await P();if(r){const{url:s,kind:t,publishableKey:o,checkoutSessionId:n}=r.action;if(t==="stripeCheckoutSession"){const i=await(await p(()=>import("./stripe.esm.dc2fab41.js"),[],import.meta.url)).loadStripe(o);if(i)i.redirectToCheckout({sessionId:n});else throw new Error("Stripe is not loaded")}else window.location.href=s;return{success:!0,action:r.action}}}catch(r){return{success:!1,message:r.response||r}}}async function D(e,r={}){try{const s=await E({product:e.alias,provider:"stripe",source:"profile",...r});if(s.actions&&s.actions.length){const{url:t,kind:o,publishableKey:n,checkoutSessionId:a}=s.actions[0];if(o==="stripeCheckoutSession"){const c=await(await p(()=>import("./stripe.esm.dc2fab41.js"),[],import.meta.url)).loadStripe(n);if(!c)throw new Error("Stripe is not loaded");c.redirectToCheckout({sessionId:a})}else window.location.href=t}return s}catch(s){return console.error("Make one time order error for suggestion.",s),{success:!1}}}async function V(e,r){try{const s=await S({subscriptionId:e,mode:r});if(s.actions&&s.actions.length){const{url:t,kind:o,publishableKey:n,checkoutSessionId:a}=s.actions[0];if(o==="stripeCheckoutSession"){const c=await(await p(()=>import("./stripe.esm.dc2fab41.js"),[],import.meta.url)).loadStripe(n);if(!c)throw new Error("Stripe is not loaded");c.redirectToCheckout({sessionId:a})}else window.location.href=t}return s}catch(s){return console.error("Switch subscription error.",s),{success:!1}}}const G={async processPayment(e,r){switch(e){case"stripe":return O({...r,provider:"stripe"});case"paypal":return A({...r,provider:"paypal"});case"wechat":return U({...r,provider:"wechat"});case"alipay":return k({...r,provider:"alipay"});case"yoo-kassa":return M({...r,provider:"yoo-kassa"});default:return{success:!1,message:"Unsupported payment system"}}},changePaymentInfo:N,makeSuggestionOrder:D,switchLicensePeriod:V},u={ICONS:"icons",PHOTOS:"photos",VECTORS:"vectors",MUSIC:"music",FULL:"full",ICONS_VECTORS:"iconsVectors",UPSCALER:"upscaler",THREEDIO:"threedio",MEGA_CREATOR:"megaCreator",BG_REMOVER:"bgRemover",FACE_SWAPPER_UNLIMITED:"faceSwapperUnlimited",LUNACY:"lunacy",LUNACY_CLOUD:"lunacyCloud",ILLUSTRATION_GENERATOR:"illustrationGenerator"},F={[u.ICONS]:"Icons",[u.PHOTOS]:"Photos",[u.VECTORS]:"Illustrations",[u.MUSIC]:"Music",[u.FULL]:"Full Set",[u.ICONS_VECTORS]:"Icons + Illustrations",[u.UPSCALER]:"Upscaler",[u.THREEDIO]:"Threedio",[u.MEGA_CREATOR]:"Mega Creator",[u.BG_REMOVER]:"Background Remover",[u.FACE_SWAPPER_UNLIMITED]:"Face Swapper",[u.LUNACY]:"Lunacy",[u.LUNACY_CLOUD]:"Lunacy cloud",[u.ILLUSTRATION_GENERATOR]:"Enhanced Illustration Generator + Fast Draft Illustration Generator"},J=R("products",()=>{const e=I({});function r(t){e.value=t}async function s(){if(!e.value.success){const t=await T({type:"regular"});r(t)}}return{products:e,fetchProducts:s,setProducts:r}}),w=["pricing"],W={subscribeClick:"flow_subscribe_click",subscribeTrial:"flow_subscribe_trial",subscribeMethods:"flow_subscribe_methods",subscribeUpgrade:"flow_subscribe_upgrade",subscribeSpecial:"flow_subscribe_special",payment:"flow_payment_confirm",paymentError:"flow_payment_error",paymentSuccess:"flow_payment_success",buy:"flow_buy_page_confirm",buyError:"flow_buy_page_error",buySuccess:"flow_buy_page_success",toSubscribe:"flow_payment_to_subscribe",paymentUndo:"flow_payment_undo",orderProcessing:"order_processing",multipleSubscribe:"flow_multiple_subscribe_open",multipleSubscribeConfirm:"flow_multiple_subscribe_confirm",multipleSubscribeError:"flow_multiple_subscribe_error"},j={upgrade:"license_action_upgrade",upgradeError:"license_error_upgrade",downgrade:"license_action_downgrade",downgradeError:"license_error_downgrade",changePayment:"license_action_change_payment",changePaymentError:"license_error_change_payment",pause:"license_action_pause",pauseError:"license_error_pause",pauseConfirm:"license_confirm_pause",resume:"license_action_resume",resumeError:"license_error_resume",cancel:"license_action_cancel",cancelError:"license_error_cancel",cancelConfirm:"license_confirm_cancel",replanishError:"license_error_replanish",replanishConfirm:"license_confirm_replanish",resubscribe:"license_action_resubscribe",resubscribeError:"license_error_resubscribe",addMember:"license_action_add_member",addMemberConfirm:"license_confirm_add_member",addMemberConfirmDirectly:"license_confirm_directly_add_member",addMemberSuccess:"license_success_add_member",addMemberError:"license_error_add_member",removeMember:"license_action_remove_member",removeMemberConfirm:"license_confirm_remove_member",removeMemberSuccess:"license_success_remove_member",removeMemberError:"license_error_remove_member"};function b(){if(window){const e=window.location.pathname;if(e==="/pricing")return"main_pricing";if(e.includes("/profile"))return"profile"}}function K(e,r){var o,n,a;const{$i8anTrack:s}=_(),t={event:W[e],productKey:r.productKey,tables:w,source:b(),amount:(n=(o=r.product)==null?void 0:o.amount)==null?void 0:n.value,paymentProvider:r.provider,transaction:r.transaction,product:(a=r.product)==null?void 0:a.name,isUpgrade:r.isUpgrade,period:r.period};s(t)}function Y(e,r){const{$i8anTrack:s}=_(),o=J().products,n=r.license.orderProvider,a=r.license.period.toLowerCase();r.license.products.forEach(i=>{const c=i.allowances.map(({resource:h})=>h),l=z(o,c)||"unknown",d={period:a,productKey:l,paymentProvider:n,event:j[e],tables:w,source:b(),product:i.name,amount:i==null?void 0:i.amount.value};s(d)})}function $(e,r){const{$i8anTrack:s}=_(),t={event:e,productKey:r==null?void 0:r.productKey,tables:w,source:b()};s(t)}function x(e){const{$i8anTrack:r,$waitI8anTrack:s}=_(),t=v("landings"),o={event:"accountPaymentFailed",tables:["features"],action:e,projectName:t};s({onReady:()=>r(o)})}const ne={track:K,trackLink:$,trackLicense:Y,trackFailedPaymentsWarning:x};function ae(e){return[u.UPSCALER,u.BG_REMOVER].includes(e)}function ce(e){return[u.FACE_SWAPPER_UNLIMITED].includes(e)}function ie(e){return[u.MEGA_CREATOR,u.ILLUSTRATION_GENERATOR].includes(e)}function q(e,r){const s=[],t=e.allowances.map(o=>o.resource);return r==null||r.products.forEach(o=>{const n=o.allowances.map(a=>a.resource);m(t,n)&&s.push(o)}),s}function B(){if(window){const e=window.location.pathname;if(e.includes("pricing"))return"pricing";if(e.includes("profile"))return"profile"}return"developers"}async function ue(e,r,s,t){const o=e.alias,n=s.map(c=>c.alias),a={source:B(),product:o,addProducts:[o],removeProducts:n,quantity:1,...t},i=e.trial;return i&&(a.trialId=i.id,a.trialDays=i.durationInDays),r==="wechat"?(a.product=o,delete a.addProducts):(a.addProducts=[o],delete a.product),await G.processPayment(r,a)}function le(e,r,s){var i;if(!e.allowances.length)return e;const t=(i=e.recurringFrequency)==null?void 0:i.toLowerCase(),o=e.allowances.map(c=>c.resource),n=new Set(o);s==null||s.products.forEach(c=>{c.allowances.map(d=>d.resource).forEach(d=>n.add(d))});const a=Object.values(r).filter(c=>typeof c=="object").filter(c=>c.resourceTypes.length>1).sort((c,l)=>l.resourceTypes.length-c.resourceTypes.length);for(const c of a){const l=m(c.resourceTypes,o),d=c.resourceTypes.every(h=>n.has(h));if(l&&d&&c[t])return c[t][0]}return e}function de(e,r){return e==null?void 0:e.find(s=>{const t=["active","paused"].includes(s.status),o=s.period===r.toUpperCase(),n=s.type==="regular",a=s.source!=="manual",i=!s.isTrial;return t&&o&&n&&a&&i})}function H(e){return e==null?void 0:e.products.reduce((r,s)=>r+s.amount.value*s.quantity,0)}function pe(e,r){const s=e.amount.value,t=H(r),n=q(e,r).reduce((a,i)=>a+i.amount.value*i.quantity,0);return s+t-n}function me(e,r,s){const t=[];for(const o in e)o.startsWith(r)&&t.push(e[o]);return t.map(o=>o[s][0]).sort((o,n)=>n.allowances.length-o.allowances.length)}function Q(e){var r;return(r=e==null?void 0:e.find(s=>!s.isSiteDefault))==null?void 0:r.isObsolete}function fe({license:e,licenses:r,product:s}){const t=[],o=s.allowances?s.allowances.map(c=>c.resource):[],n=e.products.map(c=>c.alias);e==null||e.products.forEach(c=>{t.push(...c.allowances.map(l=>l.resource))});const a=o.length&&m(t,o),i=n.includes(s.alias);return a||i||Q(r)}function _e(e,r){return e==null?void 0:e.products.some(s=>s.alias===r)}function he(e){const r=e==null?void 0:e.filter(s=>{const t=s.type==="regular",o=s.source!=="manual",n=["unsubscribed","cancelled"].includes(s.status);return t&&o&&!n});return r==null?void 0:r.some(({orderProvider:s})=>s==="stripe")}function ye(e){return e==null?void 0:e.every(r=>r.isSetupFinished)}function we(e){return e===u.UPSCALER&&!C()?"/upscaler":e===u.MEGA_CREATOR?"/mega-creator":e===u.ILLUSTRATION_GENERATOR?"/illustration-generator":e===u.THREEDIO?"/threedio":`/pricing-success?licenses=${encodeURIComponent(F[e])}`}function z(e,r){const t=Object.entries(e).find(([o,{resourceTypes:n}])=>Array.isArray(n)?n.length===r.length&&m(n,r):void 0);return t&&t[0]}function be(e,r){const s=[],{resourceTypes:t}=r[e];for(const o in r){if(o===e)continue;const n=r[o];m(t,(n==null?void 0:n.resourceTypes)||[])&&s.push(o)}return s}export{G as P,F as Q,u as a,be as b,ye as c,de as d,he as e,ie as f,B as g,ae as h,ne as i,ce as j,fe as k,H as l,pe as m,q as n,le as o,we as p,me as q,_e as r,ue as s,z as t,J as u,Q as v};
